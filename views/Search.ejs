<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('./Partials/Head'); %>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body, html {
      height: 100%;
      margin: 0;
    }
  </style>
</head>

<body class="bg-black text-white h-screen flex flex-col overflow-hidden">

  <!-- Fixed Search Header -->
  <div class="fixed top-0 left-0 right-0 z-50 bg-black px-4 py-3">
    <div class="relative w-full">
      <img src="/images/meta ai.gif" alt="Meta AI"
        class="absolute left-3 mt-8 transform -translate-y-1/2 w-6 h-6 rounded-full" />
      <input
        type="search"
        id="inputusername"
        class="block w-full p-2 pl-10 text-lg bg-zinc-800 text-white placeholder-gray-400 rounded-full"
        placeholder="Search with Meta AI"
        autocomplete="off"
        required
      />
    </div>
  </div>

  <!-- Scrollable Content -->
  <div id="searchResults" class="flex-1 mt-20 overflow-y-auto px-4 space-y-4">
    <!-- Search results will be injected here -->
  </div>

  <!-- Footer -->
  <%- include('./Partials/Footer'); %>

  <!-- Script -->
  <script>
    const inp = document.querySelector('#inputusername');
    const searchResults = document.querySelector('#searchResults');

    inp.addEventListener("input", async function () {
      const query = inp.value.trim();

      if (query.length === 0) {
        searchResults.innerHTML = ""; // clear results
        return;
      }

      try {
        const res = await axios.get(`/username/${query}`);
        const users = res.data;

        if (!users.length) {
          searchResults.innerHTML = "<p class='text-gray-400'>No users found.</p>";
          return;
        }

        const clutter = users.map(user => `
          <div class="flex items-center gap-3 border-b border-gray-700 pb-3">
            <img src="/images/uploads/${user.profileImage}" alt="" class="w-10 h-10 rounded-full" />
            <div class="flex flex-col">
              <h5 class="text-white font-semibold">${user.username}</h5>
              <h5 class="text-gray-400 text-sm">${user.name}</h5>
            </div>
          </div>
        `).join("");

        searchResults.innerHTML = clutter;
      } catch (err) {
        console.error("Error fetching users:", err);
        searchResults.innerHTML = "<p class='text-red-500'>Something went wrong!</p>";
      }
    });
  </script>
</body>

</html>
